services:
  whisper:
    build: .
    image: whisper-large-v3-api
    container_name: whisper-large-v3
    ports:
      - "8030:8030"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    volumes:
      - whisper-models:/app/models
      - ./app:/app/app
      - ./cache:/app/cache
    command:
      - python3
      - -m
      - uvicorn
      - app.main:app
      - --host
      - "0.0.0.0"
      - --port
      - "8030"
      - --timeout-keep-alive
      - "3600"

volumes:
  whisper-models:
